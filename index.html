<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯Ø±Ø¯Ø´Ø© ÙƒØ§Ù…Ù„Ø©</title>
<style>
body {margin:0;background:#121212;font-family:'Tajawal',sans-serif;color:white;display:flex;justify-content:center;align-items:center;height:100vh;}
.chat-container {width:95%;max-width:450px;height:92vh;background:#1e1e1e;border-radius:16px;display:flex;flex-direction:column;overflow:hidden;position:relative;}
header.chat-header {text-align:center;padding:15px;background:#2c2c2c;font-weight:bold;border-bottom:1px solid #333;}
.chat-messages {flex:1;padding:12px;overflow-y:auto;display:flex;flex-direction:column;gap:14px;}
.message {background:#0078ff;padding:10px 14px;max-width:75%;border-radius:12px;align-self:flex-end;word-wrap:break-word;border-bottom-right-radius:4px;position:relative;}
.status {margin-top:4px;font-size:11px;opacity:.7;text-align:right;}
img.chat-img {max-width:100%;border-radius:12px;margin-top:5px;}
.voice-btn {background:#005bbb;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;margin-top:5px;}
.chat-input {padding:10px;background:#2c2c2c;display:flex;align-items:center;gap:8px;}
.chat-input input {flex:1;background:#3c3c3c;padding:12px;border:none;color:white;border-radius:10px;}
.btn {width:45px;height:45px;background:#0078ff;border-radius:50%;border:none;font-size:20px;color:white;}
.attach-menu {display:none;position:absolute;bottom:70px;right:20px;background:#2c2c2c;border-radius:12px;padding:12px;flex-direction:column;gap:10px;}
.attach-menu button {background:#3c3c3c;padding:10px;border-radius:8px;border:none;color:white;}
#recordingBox {display:none;background:#b00020;padding:12px;text-align:center;font-weight:bold;position:absolute;bottom:60px;left:0;width:100%;animation:blink 1s infinite;}
@keyframes blink {0%{opacity:1;}50%{opacity:0.5;}100%{opacity:1;}}
</style>
</head>
<body>
<div class="chat-container">
  <header class="chat-header">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©</header>

  <div id="recordingBox">ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„â€¦ <span id="timer">00:00</span></div>

  <div class="chat-messages" id="chatMessages"></div>

  <div class="attach-menu" id="attachMenu">
    <button id="cameraBtn">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§</button>
    <button id="imageBtn">ğŸ–¼ ØµÙˆØ±Ø©</button>
    <button id="fileBtn">ğŸ“ Ù…Ù„Ù</button>
  </div>

  <div class="chat-input">
    <button class="btn" id="attachBtn">ğŸ“</button>
    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
    <button class="btn" type="button" id="micBtn">ğŸ¤</button>
    <button class="btn" type="button" id="sendBtn" style="display:none;">âœˆï¸</button>
  </div>

  <input type="file" id="cameraInput" accept="image/*" capture="camera" style="display:none;">
  <input type="file" id="imageInput" accept="image/*" style="display:none;">
  <input type="file" id="fileInput" style="display:none;">
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
const input = document.getElementById("msgInput");
const micBtn = document.getElementById("micBtn");
const sendBtn = document.getElementById("sendBtn");
const chat = document.getElementById("chatMessages");
const recordingBox = document.getElementById("recordingBox");
const timerDisplay = document.getElementById("timer");
const attachBtn = document.getElementById("attachBtn");
const attachMenu = document.getElementById("attachMenu");
const cameraInput = document.getElementById("cameraInput");
const imageInput = document.getElementById("imageInput");
const fileInput = document.getElementById("fileInput");

/* Ø²Ø± Ù…Ø§ÙŠÙƒ â†” Ø¥Ø±Ø³Ø§Ù„ */
input.addEventListener("input", () => {
  sendBtn.style.display = input.value.trim() ? "block" : "none";
  micBtn.style.display = input.value.trim() ? "none" : "block";
});

/* Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Øµ */
sendBtn.addEventListener("click", () => {
  const text = input.value.trim();
  if(text) addMessage(text, "text");
  input.value = "";
  micBtn.style.display = "block";
  sendBtn.style.display = "none";
});

/* Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© */
function addMessage(content, type="text") {
  const div = document.createElement("div");
  div.className = "message";
  if(type === "img") {
    div.innerHTML = `<img class="chat-img" src="${content}"><div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  } else if(type === "audio") {
    const btn = document.createElement("button");
    btn.className = "voice-btn";
    btn.textContent = "â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª";
    const audioEl = new Audio(content);
    btn.addEventListener("click", () => {
      document.querySelectorAll(".voice-btn").forEach(b => {
        if(b!==btn && b.audioEl){b.audioEl.pause(); b.textContent="â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª";}
      });
      if(audioEl.paused){audioEl.play(); btn.textContent="â¸ Ø¥ÙŠÙ‚Ø§Ù";}
      else {audioEl.pause(); btn.textContent="â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª";}
    });
    btn.audioEl = audioEl;
    div.appendChild(btn);
    div.innerHTML += `<div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  } else {
    div.innerHTML = `${content}<div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  }
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¨ÙˆØ³ */
attachBtn.addEventListener("click", () => {
  attachMenu.style.display = attachMenu.style.display === "flex" ? "none" : "flex";
});

/* Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
document.getElementById("cameraBtn").addEventListener("click", () => cameraInput.click());
document.getElementById("imageBtn").addEventListener("click", () => imageInput.click());
document.getElementById("fileBtn").addEventListener("click", () => fileInput.click());

[cameraInput, imageInput].forEach(inputEl => {
  inputEl.addEventListener("change", function() {
    const file = this.files[0];
    const reader = new FileReader();
    reader.onload = () => addMessage(reader.result, "img");
    reader.readAsDataURL(file);
  });
});

fileInput.addEventListener("change", function() {
  const file = this.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    if(file.type.startsWith("audio")) addMessage(reader.result, "audio");
    else addMessage(reader.result, "text");
  };
  reader.readAsDataURL(file);
});

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª */
let recorder = null;
let chunks = [];
let seconds = 0;
let timerInterval = null;

function updateTimer() {
  seconds++;
  const m = String(Math.floor(seconds/60)).padStart(2,"0");
  const s = String(seconds%60).padStart(2,"0");
  timerDisplay.textContent = `${m}:${s}`;
}

async function startRecord() {
  if(recorder) return;
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
    recorder = new MediaRecorder(stream);
    chunks = [];
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
      const blob = new Blob(chunks, { type:"audio/mp3" });
      const url = URL.createObjectURL(blob);
      addMessage(url, "audio");
      recorder = null;
    };
    recorder.start();
    seconds = 0;
    timerDisplay.textContent = "00:00";
    recordingBox.style.display = "block";
    timerInterval = setInterval(updateTimer, 1000);
  } catch(e) {
    alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ù…Ø§Ø­ Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØµÙˆØª.");
  }
}

function stopRecord() {
  if(recorder && recorder.state === "recording") recorder.stop();
  recordingBox.style.display = "none";
  clearInterval(timerInterval);
  timerInterval = null;
}

/* Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« */
micBtn.addEventListener("mousedown", startRecord);
micBtn.addEventListener("mouseup", stopRecord);
micBtn.addEventListener("touchstart", startRecord);
micBtn.addEventListener("touchend", stopRecord);

});
</script>
</body>
</html>
