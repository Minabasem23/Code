<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯Ø±Ø¯Ø´Ø© ÙƒØ§Ù…Ù„Ø©</title>

<style>
  body {
    margin: 0;
    background: #121212;
    font-family: 'Tajawal', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
  }

  .chat-container {
    width: 95%;
    max-width: 450px;
    height: 92vh;
    background: #1e1e1e;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-header {
    text-align: center;
    padding: 15px;
    background: #2c2c2c;
    font-weight: bold;
    border-bottom: 1px solid #333;
  }

  .chat-messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .message {
    background: #0078ff;
    padding: 10px 14px;
    max-width: 75%;
    border-radius: 12px;
    align-self: flex-end;
    word-wrap: break-word;
    border-bottom-right-radius: 4px;
  }

  .status {
    margin-top: 4px;
    font-size: 11px;
    opacity: .7;
    text-align: right;
  }

  img.chat-img {
    max-width: 100%;
    border-radius: 12px;
    margin-top: 5px;
  }

  audio {
    width: 100%;
    margin-top: 5px;
  }

  .chat-input {
    padding: 10px;
    background: #2c2c2c;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .chat-input input {
    flex: 1;
    background: #3c3c3c;
    padding: 12px;
    border: none;
    color: white;
    border-radius: 10px;
  }

  .btn {
    width: 45px;
    height: 45px;
    background: #0078ff;
    border-radius: 50%;
    border: none;
    font-size: 20px;
    color: white;
  }

  /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¨ÙˆØ³ */
  .attach-menu {
    display: none;
    position: absolute;
    bottom: 75px;
    right: 20px;
    background: #2c2c2c;
    border-radius: 12px;
    padding: 12px;
    display: none;
    flex-direction: column;
    gap: 10px;
  }

  .attach-menu button {
    background: #3c3c3c;
    padding: 10px;
    border-radius: 8px;
    border: none;
    color: white;
  }

  #recordingBox {
    display: none;
    background: #b00020;
    padding: 15px;
    text-align: center;
    font-weight: bold;
    animation: blink 1s infinite;
  }

  @keyframes blink {
    0% {opacity: 1;}
    50% {opacity: .5;}
    100% {opacity: 1;}
  }
</style>
</head>

<body>

<div class="chat-container">

  <div class="chat-header">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©</div>

  <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
  <div id="recordingBox">ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„â€¦ <span id="timer">00:00</span></div>

  <div class="chat-messages" id="chatMessages"></div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¨ÙˆØ³ -->
  <div class="attach-menu" id="attachMenu">
    <button onclick="openCamera()">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§</button>
    <button onclick="openImage()">ğŸ–¼ ØµÙˆØ±Ø©</button>
    <button onclick="openFile()">ğŸ“ Ù…Ù„Ù</button>
  </div>

  <div class="chat-input">
    <button class="btn" id="attachBtn">ğŸ“</button>

    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">

    <button class="btn" id="micBtn">ğŸ¤</button>
    <button class="btn" id="sendBtn" style="display:none;">âœˆï¸</button>
  </div>

  <input id="cameraInput" type="file" accept="image/*" capture="camera">
  <input id="imageInput" type="file" accept="image/*">
  <input id="fileInput" type="file">

</div>

<script>

// Ø¹Ù†Ø§ØµØ±
let input = document.getElementById("msgInput");
let micBtn = document.getElementById("micBtn");
let sendBtn = document.getElementById("sendBtn");
let chat = document.getElementById("chatMessages");

/*------------------------------------------
   ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø§ÙŠÙƒ â†” Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
-------------------------------------------*/
input.addEventListener("input", () => {
  if (input.value.trim() === "") {
    micBtn.style.display = "block";
    sendBtn.style.display = "none";
  } else {
    micBtn.style.display = "none";
    sendBtn.style.display = "block";
  }
});

/*------------------------------------------
   Ø¥Ø±Ø³Ø§Ù„ Ù†Øµ
-------------------------------------------*/
sendBtn.onclick = () => {
  let text = input.value.trim();
  if (!text) return;
  addMessage(text);
  input.value = "";
  micBtn.style.display = "block";
  sendBtn.style.display = "none";
};

/*------------------------------------------
   Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
-------------------------------------------*/
function addMessage(content, type="text") {
  let div = document.createElement("div");
  div.className = "message";

  if (type === "img") {
    div.innerHTML = `<img class="chat-img" src="${content}"><div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  } else if (type === "audio") {
    div.innerHTML = `<audio controls src="${content}"></audio><div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  } else {
    div.innerHTML = `${content}<div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  }

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/*------------------------------------------
   Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¨ÙˆØ³
-------------------------------------------*/
document.getElementById("attachBtn").onclick = () => {
  let menu = document.getElementById("attachMenu");
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
};

function openCamera() { document.getElementById("cameraInput").click(); }
function openImage() { document.getElementById("imageInput").click(); }
function openFile()  { document.getElementById("fileInput").click(); }

/*------------------------------------------
   Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±
-------------------------------------------*/
document.getElementById("imageInput").onchange =
document.getElementById("cameraInput").onchange = function() {
  let file = this.files[0];
  let reader = new FileReader();
  reader.onload = () => addMessage(reader.result, "img");
  reader.readAsDataURL(file);
};

/*------------------------------------------
   Ø±ÙØ¹ Ù…Ù„Ù (ØµÙˆØª / PDF)
-------------------------------------------*/
document.getElementById("fileInput").onchange = function() {
  let file = this.files[0];
  let reader = new FileReader();
  reader.onload = () => addMessage(reader.result, "audio");
  reader.readAsDataURL(file);
};

/*------------------------------------------
   ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
-------------------------------------------*/
let recorder;
let chunks = [];
let seconds = 0;
let timerInterval;

function updateTimer() {
  seconds++;
  let m = String(Math.floor(seconds / 60)).padStart(2, "0");
  let s = String(seconds % 60).padStart(2, "0");
  document.getElementById("timer").textContent = `${m}:${s}`;
}

async function startRecord() {
  seconds = 0;
  document.getElementById("timer").textContent = "00:00";

  let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  recorder = new MediaRecorder(stream);

  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = () => {
    let blob = new Blob(chunks, { type: "audio/mp3" });
    chunks = [];
    let url = URL.createObjectURL(blob);
    addMessage(url, "audio");
  };

  recorder.start();

  document.getElementById("recordingBox").style.display = "block";
  timerInterval = setInterval(updateTimer, 1000);
}

function stopRecord() {
  if (recorder) recorder.stop();
  document.getElementById("recordingBox").style.display = "none";
  clearInterval(timerInterval);
}

// ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„Ù„Ù…Ø³ ÙˆØ§Ù„Ù…ÙˆØ³
micBtn.onmousedown = startRecord;
micBtn.onmouseup = stopRecord;
micBtn.ontouchstart = startRecord;
micBtn.ontouchend = stopRecord;

</script>

</body>
  </html>
