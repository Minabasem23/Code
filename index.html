<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯Ø±Ø¯Ø´Ø© ÙƒØ§Ù…Ù„Ø©</title>

<style>
  body {
    margin: 0;
    background: #121212;
    font-family: 'Tajawal', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
  }

  .chat-container {
    width: 95%;
    max-width: 450px;
    height: 92vh;
    background: #1e1e1e;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-header {
    text-align: center;
    padding: 15px;
    background: #2c2c2c;
    font-weight: bold;
    border-bottom: 1px solid #333;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .message {
    max-width: 75%;
    padding: 10px 14px;
    background: #0078ff;
    border-radius: 12px;
    align-self: flex-end;
    word-wrap: break-word;
    position: relative;
    border-bottom-right-radius: 4px;
  }

  .received {
    background: #2f2f2f;
    align-self: flex-start;
    border-bottom-left-radius: 4px;
  }

  .status {
    font-size: 11px;
    text-align: right;
    margin-top: 4px;
    opacity: .8;
  }

  img.chat-img {
    margin-top: 6px;
    max-width: 100%;
    border-radius: 12px;
  }

  audio {
    margin-top: 6px;
    width: 100%;
  }

  /* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
  .chat-input {
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    background: #2c2c2c;
  }

  .chat-input input {
    flex: 1;
    padding: 12px;
    border: none;
    background: #3c3c3c;
    color: white;
    border-radius: 10px;
  }

  .btn {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #0078ff;
    border: none;
    color: white;
    font-size: 20px;
  }

  /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  .attach-menu {
    position: absolute;
    bottom: 70px;
    right: 20px;
    background: #2c2c2c;
    padding: 12px;
    border-radius: 12px;
    display: none;
    flex-direction: column;
    gap: 10px;
  }

  .attach-menu button {
    background: #3c3c3c;
    border: none;
    padding: 10px;
    border-radius: 8px;
    color: white;
  }

  input[type="file"] {
    display: none;
  }
</style>
</head>

<body>

<div class="chat-container">

  <div class="chat-header">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©</div>

  <div class="chat-messages" id="chatMessages"></div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¨ÙˆØ³ -->
  <div class="attach-menu" id="attachMenu">
    <button onclick="openCamera()">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§</button>
    <button onclick="openImage()">ğŸ–¼ ØµÙˆØ±Ø©</button>
    <button onclick="openFile()">ğŸ“ Ù…Ù„Ù</button>
  </div>

  <!-- Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
  <div class="chat-input">

    <button class="btn" id="attachBtn">ğŸ“</button>

    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">

    <!-- Ø²Ø± Ø§Ù„Ù…Ø§ÙŠÙƒ -->
    <button class="btn" id="micBtn">ğŸ¤</button>

    <!-- Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
    <button class="btn" id="sendBtn" style="display:none;">âœˆï¸</button>

  </div>

  <!-- Ù…Ù„ÙØ§Øª -->
  <input id="cameraInput" type="file" accept="image/*" capture="camera">
  <input id="imageInput" type="file" accept="image/*">
  <input id="fileInput" type="file">

</div>

<script>

let chat = document.getElementById("chatMessages");
let input = document.getElementById("msgInput");
let micBtn = document.getElementById("micBtn");
let sendBtn = document.getElementById("sendBtn");

/*------------------------------------------
    1) ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø§ÙŠÙƒ Ø¥Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
-------------------------------------------*/
input.addEventListener("input", () => {
  if (input.value.trim() === "") {
    micBtn.style.display = "block";
    sendBtn.style.display = "none";
  } else {
    micBtn.style.display = "none";
    sendBtn.style.display = "block";
  }
});

/*------------------------------------------
    2) Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©
-------------------------------------------*/
sendBtn.onclick = () => {
  let text = input.value.trim();
  if (!text) return;
  addMessage(text);
  input.value = "";
  micBtn.style.display = "block";
  sendBtn.style.display = "none";
};

/*------------------------------------------
    3) Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
-------------------------------------------*/
function addMessage(content, type="text") {
  let div = document.createElement("div");
  div.className = "message";

  if (type === "img")
    div.innerHTML = `<img class='chat-img' src='${content}'><div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  else if (type === "audio")
    div.innerHTML = `<audio controls src="${content}"></audio><div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  else
    div.innerHTML = `${content}<div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/*------------------------------------------
    4) Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¨ÙˆØ³
-------------------------------------------*/
document.getElementById("attachBtn").onclick = () => {
  let menu = document.getElementById("attachMenu");
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
};

function openCamera(){
  document.getElementById("cameraInput").click();
}

function openImage(){
  document.getElementById("imageInput").click();
}

function openFile(){
  document.getElementById("fileInput").click();
}

/*------------------------------------------
    5) Ø±ÙØ¹ ØµÙˆØ±Ø©
-------------------------------------------*/
document.getElementById("imageInput").onchange =
document.getElementById("cameraInput").onchange = function() {
  let file = this.files[0];
  let reader = new FileReader();
  reader.onload = () => addMessage(reader.result, "img");
  reader.readAsDataURL(file);
};

/*------------------------------------------
    6) Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØª / PDF / Word
-------------------------------------------*/
document.getElementById("fileInput").onchange = function() {
  let file = this.files[0];
  let reader = new FileReader();
  reader.onload = () => addMessage(reader.result, "audio");
  reader.readAsDataURL(file);
};

/*------------------------------------------
    7) ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª Ø­Ù‚ÙŠÙ‚ÙŠ ğŸ¤
-------------------------------------------*/
let recorder;
let chunks = [];

micBtn.onmousedown = startRecord;
micBtn.onmouseup = stopRecord;

async function startRecord(){
  let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  recorder = new MediaRecorder(stream);

  recorder.ondataavailable = e => chunks.push(e.data);

  recorder.onstop = () => {
    let blob = new Blob(chunks, {type: "audio/mp3"});
    chunks = [];
    let url = URL.createObjectURL(blob);
    addMessage(url, "audio");
  };

  recorder.start();
}

function stopRecord(){
  if (recorder) recorder.stop();
}

</script>

</body>
</html>