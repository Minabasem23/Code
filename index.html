<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Ù…Ø¹ Ø¯Ø¨ÙˆØ³</title>
<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:'Tajawal',sans-serif;
  display:flex;
  justify-content:center;
}
.chat{
  width:95%;
  max-width:450px;
  height:97vh;
  background:#000;
  border-left:1px solid #fff;
  border-right:1px solid #fff;
  display:flex;
  flex-direction:column;
  position:relative;
}
header{
  text-align:center;
  padding:12px;
  border-bottom:1px solid #fff;
}
#chatBox{
  flex:1;
  overflow-y:auto;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.message{
  align-self:flex-end;
  border:1px solid #fff;
  border-radius:10px;
  padding:10px;
  max-width:75%;
  position:relative;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.msg-text{
  white-space:pre-wrap;
  word-break:break-word;
}
.status{
  font-size:11px;
  opacity:.6;
  text-align:right;
}
#inputArea{
  display:flex;
  padding:10px;
  gap:8px;
}
#msgInput{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:1px solid #fff;
  background:#000;
  color:#fff;
}
.btn{
  width:55px;
  height:45px;
  border-radius:50%;
  border:1px solid #fff;
  background:#000;
  color:#fff;
  font-size:16px;
}
.msg-toolbar{
  position:absolute;
  background:#fff;
  color:#000;
  padding:5px;
  border-radius:8px;
  display:flex;
  gap:6px;
  z-index:1000;
}
.msg-toolbar button{
  background:#fff;
  border:1px solid #000;
  border-radius:4px;
  padding:4px 6px;
}
audio{
  width:150px;
}
#recordingBox{
  display:none;
  background:#fff;
  color:#000;
  padding:12px;
  text-align:center;
  font-weight:bold;
  position:absolute;
  bottom:60px;
  left:0;
  width:100%;
  border-radius:8px;
}
.attach-bar{
  position:absolute;
  bottom:-70px;
  left:0;
  width:100%;
  background:#000;
  border-top-left-radius:12px;
  border-top-right-radius:12px;
  padding:10px;
  display:flex;
  justify-content:space-around;
  transition:bottom 0.3s;
}
.attach-bar.show{bottom:60px;}
.attach-bar button{
  background:#000;
  border:1px solid #fff;
  padding:12px;
  border-radius:10px;
  color:#fff;
  font-size:14px;
}
</style>
</head>
<body>

<div class="chat">

<header>Chat Ù…Ø¹ Ø¯Ø¨ÙˆØ³</header>

<div id="recordingBox">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„â€¦ <span id="timer">00:00</span></div>

<div id="chatBox"></div>

<div id="inputArea">
  <button class="btn" id="attachBtn">ğŸ“Œ</button>
  <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨...">
  <button class="btn" id="micBtn">Mic</button>
</div>

<div class="attach-bar" id="attachBar">
  <button id="fileBtn">File</button>
  <button id="cameraBtn">Camera</button>
  <button id="imageBtn">Image</button>
  <button id="pollBtn">Poll</button>
  <button id="locationBtn">Location</button>
</div>

<input type="file" id="cameraInput" accept="image/*" capture="camera" style="display:none;">
<input type="file" id="imageInput" accept="image/*" style="display:none;">
<input type="file" id="fileInput" style="display:none;">

</div>

<script>
const chatBox = document.getElementById("chatBox");
const msgInput = document.getElementById("msgInput");
const micBtn = document.getElementById("micBtn");
const attachBtn = document.getElementById("attachBtn");
const attachBar = document.getElementById("attachBar");
const cameraInput = document.getElementById("cameraInput");
const imageInput = document.getElementById("imageInput");
const fileInput = document.getElementById("fileInput");
const recordingBox = document.getElementById("recordingBox");
const timerDisplay = document.getElementById("timer");

let recorder=null, chunks=[], seconds=0, timerInterval=null, isRecording=false;

/* Toggle Attach Bar */
attachBtn.addEventListener("click", ()=>{ attachBar.classList.toggle("show"); });

cameraInput.addEventListener("change", function(){ 
  const file=this.files[0]; if(!file) return; 
  const reader=new FileReader(); 
  reader.onload=()=>addMessage(reader.result,"img"); 
  reader.readAsDataURL(file); 
});
imageInput.addEventListener("change", function(){ 
  const file=this.files[0]; if(!file) return; 
  const reader=new FileReader(); 
  reader.onload=()=>addMessage(reader.result,"img"); 
  reader.readAsDataURL(file); 
});
fileInput.addEventListener("change", function(){ 
  const file=this.files[0]; if(!file) return; 
  const reader=new FileReader(); 
  reader.onload=()=>addMessage(reader.result,"text"); 
  reader.readAsDataURL(file); 
});

document.getElementById("cameraBtn").addEventListener("click",()=>cameraInput.click());
document.getElementById("imageBtn").addEventListener("click",()=>imageInput.click());
document.getElementById("fileBtn").addEventListener("click",()=>fileInput.click());

document.getElementById("pollBtn").addEventListener("click", ()=>{
  const question = prompt("Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹:");
  if(!question) return;
  const option1 = prompt("Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„:");
  const option2 = prompt("Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ:");
  if(option1 && option2){ addMessage(`Poll: ${question}\n1: ${option1}\n2: ${option2}`,"text"); }
});

document.getElementById("locationBtn").addEventListener("click", ()=>{
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat = pos.coords.latitude; const lon = pos.coords.longitude;
      addMessage(`Location: https://www.google.com/maps?q=${lat},${lon}`,"text");
    }, ()=>alert("ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹."));
  } else alert("Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ….");
});

/* Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© */
function addMessage(content,type="text"){
  const msg = document.createElement("div");
  msg.className="message";

  let inner = document.createElement("span");
  inner.className="msg-text";

  if(type==="text"){ inner.textContent = content; msg.appendChild(inner); }
  else if(type==="img"){ inner.innerHTML=`<img src="${content}" style="max-width:100%; border-radius:8px;">`; msg.appendChild(inner); }
  else if(type==="audio"){ inner.innerHTML=`<audio controls src="${content}"></audio>`; msg.appendChild(inner); }

  let sts = document.createElement("div");
  sts.className="status";
  sts.textContent="Read";
  msg.appendChild(sts);

  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;

  /* Toolbar */
  msg.addEventListener("click", ()=>{
    const old = document.querySelector(".msg-toolbar"); if(old) old.remove();
    const toolbar = document.createElement("div"); toolbar.className="msg-toolbar";
    toolbar.style.top = (msg.getBoundingClientRect().top + window.scrollY - 40) + "px";
    toolbar.style.left = msg.getBoundingClientRect().left + "px";
    const copyBtn=document.createElement("button"); copyBtn.textContent="Copy";
    const editBtn=document.createElement("button"); editBtn.textContent="Edit";
    const delBtn=document.createElement("button"); delBtn.textContent="Delete";
    toolbar.appendChild(copyBtn); toolbar.appendChild(editBtn); toolbar.appendChild(delBtn);
    document.body.appendChild(toolbar);

    copyBtn.onclick=()=>{ navigator.clipboard.writeText(msg.querySelector(".msg-text").innerText); toolbar.remove(); };
    editBtn.onclick=()=>{ let t=msg.querySelector(".msg-text"); let nt=prompt("Edit:",t.innerText); if(nt!==null) t.innerText=nt; toolbar.remove(); };
    delBtn.onclick=()=>{ msg.remove(); toolbar.remove(); };

    document.addEventListener("click", function hide(ev){ if(!msg.contains(ev.target)&&!toolbar.contains(ev.target)){ toolbar.remove(); document.removeEventListener("click",hide);} });
  });
}

/* ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª */
function updateTimer(){ seconds++; const m=String(Math.floor(seconds/60)).padStart(2,"0"); const s=String(seconds%60).padStart(2,"0"); timerDisplay.textContent=`${m}:${s}`; }
async function startRecording(){ if(isRecording) return; isRecording=true;
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  recorder=new MediaRecorder(stream); chunks=[];
  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.onstop=()=>{
    if(chunks.length>0){ const blob=new Blob(chunks,{type:"audio/mp3"}); const url=URL.createObjectURL(blob); addMessage(url,"audio"); }
    stream.getTracks().forEach(t=>t.stop()); recorder=null; chunks=[]; recordingBox.style.display="none"; clearInterval(timerInterval); timerInterval=null; seconds=0; timerDisplay.textContent="00:00"; isRecording=false;
  };
  recorder.start(); seconds=0; timerDisplay.textContent="00:00"; recordingBox.style.display="block"; timerInterval=setInterval(updateTimer,1000);
}
function stopRecording(){ if(!isRecording) return; if(recorder && recorder.state==="recording") recorder.stop(); recordingBox.style.display="none"; clearInterval(timerInterval); timerInterval=null; seconds=0; timerDisplay.textContent="00:00"; }

/* Ø²Ø± Mic â†” Send */
msgInput.addEventListener("input", ()=>{ micBtn.textContent = msgInput.value.trim().length ? "Send":"Mic"; });
micBtn.addEventListener("click", ()=>{
  if(msgInput.value.trim().length){ addMessage(msgInput.value,"text"); msgInput.value=""; micBtn.textContent="Mic"; }
  else{ if(!isRecording) startRecording(); else stopRecording(); }
});
</script>

</body>
</html>
