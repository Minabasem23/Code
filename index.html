<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠ</title>
<style>
body {margin:0; background:#121212; font-family:'Tajawal',sans-serif; color:white; display:flex; justify-content:center; align-items:center; height:100vh;}
.chat-container {width:95%; max-width:450px; height:92vh; background:#1e1e1e; border-radius:16px; display:flex; flex-direction:column; overflow:hidden; position:relative;}
header.chat-header {text-align:center; padding:15px; background:#2c2c2c; font-weight:bold; border-bottom:1px solid #333;}
.chat-messages {flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:14px;}
.message {background:#0078ff; padding:10px 14px; max-width:75%; border-radius:12px; align-self:flex-end; word-wrap:break-word; border-bottom-right-radius:4px; position:relative;}
.status {margin-top:4px; font-size:11px; opacity:.7; text-align:right;}
img.chat-img {max-width:100%; border-radius:12px; margin-top:5px;}
#recordingBox {display:none; background:#b00020; padding:12px; text-align:center; font-weight:bold; position:absolute; bottom:60px; left:0; width:100%; animation:blink 1s infinite;}
@keyframes blink {0%{opacity:1;} 50%{opacity:0.5;} 100%{opacity:1;}}
.chat-input {padding:10px; background:#2c2c2c; display:flex; align-items:center; gap:8px; position:relative;}
.chat-input input {flex:1; background:#3c3c3c; padding:12px; border:none; color:white; border-radius:10px;}
.btn {width:60px; height:45px; background:#0078ff; border-radius:50%; border:none; font-size:20px; color:white;}
.attach-bar {display:none; position:absolute; bottom:60px; left:0; width:100%; background:#2c2c2c; border-top-left-radius:12px; border-top-right-radius:12px; padding:10px; flex-direction:row; justify-content:space-around;}
.attach-bar button {background:#3c3c3c; padding:12px; border-radius:10px; border:none; color:white; font-size:16px;}
</style>
</head>
<body>

<div class="chat-container">
  <header class="chat-header">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</header>

  <div id="recordingBox">ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„â€¦ <span id="timer">00:00</span></div>

  <div class="chat-messages" id="chatMessages"></div>

  <div class="chat-input">
    <button class="btn" id="attachBtn">ğŸ“</button>
    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
    <button class="btn" id="micBtn">ğŸ¤</button>
  </div>

  <div class="attach-bar" id="attachBar">
    <button id="fileBtn">ğŸ“ Ù…Ù„Ù</button>
    <button id="cameraBtn">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§</button>
    <button id="imageBtn">ğŸ–¼ ØµÙˆØ±Ø©</button>
    <button id="pollBtn">ğŸ“Š Ø§Ø³ØªØ·Ù„Ø§Ø¹</button>
    <button id="locationBtn">ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ</button>
  </div>

  <input type="file" id="cameraInput" accept="image/*" capture="camera" style="display:none;">
  <input type="file" id="imageInput" accept="image/*" style="display:none;">
  <input type="file" id="fileInput" style="display:none;">
</div>

<script>
const chat = document.getElementById("chatMessages");
const attachBtn = document.getElementById("attachBtn");
const attachBar = document.getElementById("attachBar");
const cameraInput = document.getElementById("cameraInput");
const imageInput = document.getElementById("imageInput");
const fileInput = document.getElementById("fileInput");
const micBtn = document.getElementById("micBtn");
const msgInput = document.getElementById("msgInput");
const recordingBox = document.getElementById("recordingBox");
const timerDisplay = document.getElementById("timer");

let recorder=null, stream=null, chunks=[], seconds=0, timerInterval=null, isRecording=false;

/* Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª */
attachBtn.addEventListener("click", ()=>{ attachBar.style.display = attachBar.style.display==="flex"?"none":"flex"; attachBar.style.flexDirection="row"; });

/* Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª */
cameraInput.addEventListener("change", function(){ const file=this.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>addMessage(reader.result,"img"); reader.readAsDataURL(file); });
imageInput.addEventListener("change", function(){ const file=this.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>addMessage(reader.result,"img"); reader.readAsDataURL(file); });
fileInput.addEventListener("change", function(){ const file=this.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>addMessage(reader.result,"text"); reader.readAsDataURL(file); });

document.getElementById("cameraBtn").addEventListener("click",()=>cameraInput.click());
document.getElementById("imageBtn").addEventListener("click",()=>imageInput.click());
document.getElementById("fileBtn").addEventListener("click",()=>fileInput.click());

/* Ø²Ø± Ø§Ø³ØªØ·Ù„Ø§Ø¹ */
document.getElementById("pollBtn").addEventListener("click", ()=>{
  const question = prompt("Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹:");
  if(!question) return;
  const option1 = prompt("Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„:");
  const option2 = prompt("Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ:");
  if(option1 && option2){
    addMessage(`ğŸ“Š Ø§Ø³ØªØ·Ù„Ø§Ø¹: ${question}\n1ï¸âƒ£ ${option1}\n2ï¸âƒ£ ${option2}`,"text");
  }
});

/* Ø²Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
document.getElementById("locationBtn").addEventListener("click", ()=>{
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      addMessage(`ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ: https://www.google.com/maps?q=${lat},${lon}`,"text");
    }, ()=>alert("ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹."));
  } else alert("Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ….");
});

/* Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø© */
function addMessage(content,type="text"){
  const div=document.createElement("div"); div.className="message";
  if(type==="img") div.innerHTML=`<img class="chat-img" src="${content}"><div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  else div.innerHTML=`${content}<div class="status">âœ“âœ“ ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª */
function updateTimer(){ seconds++; const m=String(Math.floor(seconds/60)).padStart(2,"0"); const s=String(seconds%60).padStart(2,"0"); timerDisplay.textContent=`${m}:${s}`; }

async function startRecording(){ if(isRecording) return; isRecording=true;
try{
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
  stream=await navigator.mediaDevices.getUserMedia({audio:true});
  recorder=new MediaRecorder(stream); chunks=[];
  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.onstop=()=>{
    if(chunks.length>0){ const blob=new Blob(chunks,{type:"audio/mp3"}); const url=URL.createObjectURL(blob); addMessage(url,"text"); }
    if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
    recorder=null; chunks=[]; recordingBox.style.display="none";
    clearInterval(timerInterval); timerInterval=null; seconds=0; timerDisplay.textContent="00:00"; isRecording=false;
  };
  recorder.start(); seconds=0; timerDisplay.textContent="00:00"; recordingBox.style.display="block";
  timerInterval=setInterval(updateTimer,1000);
}catch(e){ alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†."); console.error(e); isRecording=false; }
}

function stopRecording(){ if(!isRecording) return; isRecording=false; if(recorder && recorder.state==="recording") recorder.stop(); recordingBox.style.display="none"; clearInterval(timerInterval); timerInterval=null; seconds=0; timerDisplay.textContent="00:00"; }

micBtn.addEventListener("pointerdown", ()=>{ if(!isRecording) startRecording(); else stopRecording(); });

</script>

</body>
</html>
